# 코어데이터

`되새김`어플을 만들면서도 코어데이터를 사용했지만 깊은 학습없이 엔티티를 만들고.. fetch해오고의 반복이였던 것 같다. 이번에는 내부 동작까지 어떻게 이루어지는지 공부하면서 코어데이터란 무엇이고 어떻게 이루어져있고, 어떤특징이 있으며 어떤 기능을 지원하는지에 대해 알아보자.

## 코어데이터란?
코어데이터란 `객체지향 데이터베이스`를 위한 `객체 그래프 관리`프레임워크이다. 단순히 배열이나 리스트가 아닌 체계적인 데이터베이스를 관리해야할 때 필요하다. 주의해야할 점은 **밖에서 보기에는 객체지향 데이터베이스이지만 내부는 관계형 데이터베이스(Relational Database)라는 점**이다. 주로 처리하는 건 관계형 데이터베이스 중에서 SQL기반이다. 하지만 사용하는 입장에서 SQL을 직접 사용할 필요는 없다.

## 그렇다면 코어데이터 == 데이터베이스 인가?
코어데이터는 관계형 데이터베이스라고 했다. 이런말만듣고 또 사용하다보면 코어데이터가 데이터베이스인가? 착각할 수 있지만 이는 올바른 이해가 아니다. 정확히 하면 코어데이터는 데이터베이스가 아니고 코어데이터의 기능 중 하나인 **Persistence**가 관계형 데이터베이스인 SQLite에 의해 지원되는 것이다. 이 말은 곧 데이터베이스의 기능을 코어데이터가 지원하기도 하고 SQLite에 없는 코어데이터의 고유기능을 가지고 잇기도 하다는 의미이다.

**코어데이터는 애플리케이션 모델 계층의 객체를 관리하는데 사용하는 `프레임워크` 이자 객체의 라이프 사이클이나 영속성관리를 위한 기능을 제공하는 `객체 그래프 관리자` 이다.**

**`객체 그래프 관리자`** 라는 단어에서 알 수 있듯이 외부에서 보기에는 객체지향 데이터베이스의 형태를 띄고 있지만 그 내부에는 SQLite 데이터베이스 처럼 기능하고 있다.

## 코어데이터 vs 데이터베이스
먼저 데이터베이스의 주된기능에 대해서 생각해보자. 데이터베이스는 **영속적이고 검색 가능한 테이블 구조의 행/열로 구성된 데이터 저장소**라고 생각할 수 있다. 이 저장소의 목적은 **디스크에 항상 최신의 데이터를 저장하는 것과 데이터를 불러오고 업데이트 하는 것**이다. 많은 데이터베이스들이 관계형이라고 불리지만 SQLite와 많은 다른 관계형 데이터베이스들은 실제로 객체들의 직접적 연결을 다루지는 않는다. 테이블 간의 행/열에 관한 관계를 유지하는 것은 데이터베이스를 사용하는 사용자가 해야한다. 이러한 관점에서 데이터베이스는 `멍청한(dumb)`저장소이다. 테이블의 열을 다룰 경우 읽기/쓰기 이상의 동작이 거의 전부이고 이를 확장하거나 커스터마이징 하기 위해서는 결국 데이터베이스 시스템 전체를 확장할 수 밖에 없다.

그렇다면 `코어데이터`의 주된기능은 무엇일까? 코어데이터의 본질은 라이프사이클, 검색, 영속성 기능을 가진 객체 그래프 관리자(object graph manager)이다. 객체그래프 관리는 아래 기능들을 의미한다.
- 객체 A와 객체 B를 연결할 수 있으며, 해당 연결은 영속적으로 동기화 한다.(A쪽에서 연결을 변경하면, B가 업데이트 되면서 그에따른 알림(notification)을 발생시킨다. 그리고 이 알림에대해 임의로 코드를 짜넣어서 실행하는 것이 가능하다.)
- 한쪽에서 객체를 삭제할 경우 연결을 타고 `cascade`하게 삭제가 일어나도록 할 수도 있고, `nullify`시켜서 해당 객체만 삭제할 수도 있다.

보통의 데이터베이스와는 다르게 코어데이터는 완전한 `in-memory`형태로 사용이 가능하다. 일반적으로 사용자들이 영속성 특성을 대부분 사용하기 때문에 코어데이터가 `객체 영속성`프레임워크라고 불리지만 실제로는 어떠한 형태의 영속성도 지니지 않은 `in-memory`형태로 사용하는 것이 가능한 것이다. 즉 코어데이터를 사용할 때 `영속성`이 의무적인 기능이 아니란 것을 아는 것이 중요하다.

또한 코어데이터를 어떠한 형태의 검색기능 없이도 사용가능하다. 일단 객체들이 할당되고 연결되었을 경우, 한 객체에만 접근이 가능하다면, 추가적인 불러오기(fetch)없이 해당객체로부터 나머지 연결된 객체들을 타고 넘어가면서 접근이 가능하다. 일단 데이터들이 메모리에 로딩되면, 연결고리를 따라 이동하는 것은 검색 없이도 가능하기 때문에 코어데이터가 이러한 `비검색(searchless)`특성을 가지게 된다. 

모든 코어데이터 객체들은 완전히 인스턴스화된(fully instantiated) Objective-C객체이며 속성값과, 관계, 라이프사이클을 관리하는 것이 가능하다. 이것은 또한 객체들의 속성들과 동작들이 메서드에의해 구현될 수 있음을 의미하며, 이러한 메서드들은 서브클래싱을 통해 옵저브와 오버라이드가 가능하다.(observable & overriding)

## CoreData와 UserDefaults
